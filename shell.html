<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>AltairEgo BASIC</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'VT323', monospace;
        background-color: #d2b48c; /* Tan color, like old plastic */
        color: #33ff33; /* Bright green text */
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        box-sizing: border-box;
      }
      .terminal {
        background-color: #2c2c2c; /* Dark gray */
        border: 20px solid #8c7b6c; /* Darker tan */
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.5);
        padding: 20px;
        width: 80%;
        max-width: 800px;
        height: 80vh;
        display: flex;
        flex-direction: column;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        color: #f0f0f0;
      }
      .logo svg {
        width: 50px;
        height: 50px;
        fill: #f0f0f0;
      }
      h1 {
        margin: 0;
        font-size: 2em;
        text-shadow: 0 0 5px #33ff33;
      }
      .github-link {
        color: #f0f0f0;
        text-decoration: none;
        font-size: 24px;
      }
      .github-link:hover {
        color: #33ff33;
      }
      .screen {
        background-color: #000;
        border: 2px solid #555;
        border-radius: 5px;
        flex: 1;
        overflow-y: scroll;
        padding: 10px;
        box-sizing: border-box;
        position: relative;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        margin-bottom: 10px;
      }
      .screen::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
        z-index: 2;
        background-size: 100% 4px, 3px 100%;
        pointer-events: none;
      }
      #output {
        width: 100%;
        color: #33ff33;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      #input-container {
        display: flex;
        margin-top: 15px;
      }
      #input-prompt {
        color: #33ff33;
        margin-right: 5px;
      }
      #input {
        flex: 1;
        background-color: transparent;
        border: none;
        color: #33ff33;
        font-family: 'VT323', monospace;
        font-size: 1em;
        outline: none;
      }
    </style>
  </head>
  <body>
    <div class="terminal">
      <div class="header">
        <div class="logo">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 610 393">
            <rect width="587.56" height="370.88" x="87.55" y="598.65" fill="#a9d1ff" stroke="#747f8d" stroke-width=".997" rx="12.12" ry="12.12" transform="translate(-81.18 -592.52)"/>
            <rect width="521.14" height="247.61" x="120.76" y="622.57" fill="#eee982" rx="11.88" ry="11.88" transform="translate(-81.18 -592.52)"/>
            <g transform="translate(-84.03 -1.97)">
              <path fill="#e4e3da" d="M320.5 151.22H448v42.5H320.5z"/>
              <path id="c" fill="none" stroke="#5d4b4b" stroke-width=".9" d="M389.42 219.9a127.14 127.14 0 0 1-.65-82.9"/>
              <use xlink:href="#c" id="d" transform="translate(19.96 6.96) scale(.96081)"/>
              <use xlink:href="#d" id="e" transform="translate(23.74 8.27) scale(.95339)"/>
              <use xlink:href="#e" id="f" transform="translate(24.9 8.68) scale(.9511)"/>
              <use xlink:href="#f" id="g" transform="translate(26.18 9.12) scale(.9486)"/>
              <use xlink:href="#g" id="h" transform="translate(24.15 8.42) scale(.95258)"/>
              <use xlink:href="#h" id="i" transform="translate(25.35 8.84) scale(.95022)"/>
              <use xlink:href="#i" id="j" transform="translate(30.49 10.63) scale(.94013)"/>
              <use xlink:href="#j" id="k" transform="translate(32.43 11.3) scale(.93632)"/>
              <use xlink:href="#k" id="l" transform="translate(34.64 12.07) scale(.93199)"/>
              <use xlink:href="#l" id="m" transform="translate(32.52 11.33) scale(.93615)"/>
              <use xlink:href="#m" transform="translate(44.66 15.57) scale(.9123)"/>
              <path fill="#a6a6a6" d="M253.31 136.72c-24.79 0-42.22 19.96-42.22 44.75s17.43 44.75 42.22 44.75H515.25c24.79 0 43.23-19.96 43.23-44.75s-18.44-44.75-43.23-44.75H253.31zm67.19 14.5H448v42.5H320.5v-42.5z"/>
              <g id="n">
                <path fill="#5d5d5d" d="M244.28 270.93a20.36 20.36 0 1 1-40.71 0 20.36 20.36 0 1 1 40.71 0" transform="rotate(134.61 383.82 121.7) scale(1.81579)"/>
                <path fill="#727272" d="M244.28 270.93a20.36 20.36 0 1 1-40.71 0 20.36 20.36 0 1 1 40.71 0" transform="translate(75.9 -199.91) scale(1.7807)"/>
                <path fill="#fff" d="M244.28 270.93a20.36 20.36 0 1 1-40.71 0 20.36 20.36 0 1 1 40.71 0" transform="translate(170.18 -95.34) scale(1.39474)"/>
                <path fill="#808183" d="M348.83 333.79c-4.14 4.37-9.46-5.8-14.74-2.93-5.28 2.87.36 12.87-5.55 13.97-5.91 1.1-4.25-10.25-10.21-11.03-5.96-.78-7.27 10.62-12.7 8.04-5.43-2.58 2.59-10.8-1.77-14.93-4.37-4.13-12.13 4.32-15-1-2.88-5.28 8.44-7.2 7.34-13.11-1.1-5.92-12.35-3.64-11.57-9.6.78-5.96 11.06-.87 13.65-6.3 2.58-5.43-7.85-10.2-3.71-14.57s9.46 5.8 14.74 2.93c5.28-2.88-.36-12.87 5.55-13.97 5.92-1.1 4.25 10.25 10.21 11.03 5.96.78 7.27-10.62 12.7-8.04 5.43 2.58-2.59 10.8 1.77 14.93 4.37 4.13 12.13-4.32 15 1 2.87 5.28-8.44 7.2-7.34 13.11 1.1 5.92 12.35 3.64 11.57 9.6-.78 5.96-11.06.87-13.65 6.3-2.58 5.43 7.85 10.2 3.71 14.57z" transform="translate(288.82 72.95) scale(.68031)"/>
              </g>
              <use xlink:href="#n" transform="rotate(60 384.41 63.28)"/>
            </g>
            <path fill="none" stroke="#d7d7d3" stroke-width="3" d="M320.5 152.72H446.5v41.01"/>
            <path fill="#e4e3da" fill-opacity=".533" d="M320.5 151.22H448v42.5H320.5z"/>
          </g>
          <g id="o">
            <path fill="#343c45" d="M251.78 530.87a12.88 12.88 0 1 1-25.76 0 12.88 12.88 0 1 1 25.76 0" transform="translate(-22.9 387.82) scale(1.05546)"/>
            <path fill="#808183" d="M251.78 530.87a12.88 12.88 0 1 1-25.76 0 12.88 12.88 0 1 1 25.76 0" transform="translate(-9.4 417.94)"/>
          </g>
          <use xlink:href="#o" id="p" transform="translate(108.39 177.9) scale(.80296)"/>
          <use xlink:href="#o" transform="translate(284)"/>
          <use xlink:href="#p" transform="translate(166)"/>
        </svg>
      </div>
      <h1>AltairEgo BASIC</h1>
        <a href="https://github.com/jlowder/AltairEgo" class="github-link" target="_blank" title="View on GitHub">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
        </a>
      </div>
      <div class="screen">
        <pre id="output">Loading...</pre>
      </div>
      <div id="input-container">
        <span id="input-prompt">&gt;</span>
        <input type="text" id="input" placeholder="Enter a BASIC command" autofocus>
      </div>
    </div>

    <script>
const awariGame = `
5 PRINT TAB(34);"AWARI"
7 PRINT TAB(15);"CREATIVE COMPUTING  MORRISTOWN, NEW JERSEY"
10 DATA 0
15 DIM B(13),G(13),F(50):READ N
20 PRINT:PRINT:E=0
25 FOR I=0 TO 12:B(I)=3:NEXT I
30 C=0:F(N)=0:B(13)=0:B(6)=0
35 GOSUB 500
40 PRINT "YOUR MOVE";:GOSUB 110
45 IF E=0 THEN 80
50 IF M=H THEN GOSUB 100
55 IF E=0 THEN 80
60 PRINT "MY MOVE IS ";:GOSUB 800
65 IF E=0 THEN 80
70 IF M=H THEN PRINT ",";:GOSUB 800
75 IF E>0 THEN 35
80 PRINT:PRINT"GAME OVER"
85 D=B(6)-B(13):IF D<0 THEN PRINT "I WIN BY";-D;"POINTS":GOTO 20
90 N=N+1:IF D=0 THEN PRINT "DRAWN GAME":GOTO 20
95 PRINT "YOU WIN BY";D;"POINTS":GOTO 20
100 PRINT "AGAIN";
110 INPUT M:IF M<7 THEN IF M>0 THEN M=M-1:GOTO 130
120 PRINT "ILLEGAL MOVE":GOTO 100
130 IF B(M)=0 THEN 120
140 H=6:GOSUB 200
150 GOTO 500
200 K=M:GOSUB 600
205 E=0:IF K>6 THEN K=K-7
210 C=C+1:IF C<9 THEN F(N)=F(N)*6+K
215 FOR I=0 TO 5:IF B(I)<>0 THEN 230
220 NEXT I
225 RETURN
230 FOR I=7 TO 12:IF B(I)<>0 THEN E=1:RETURN
235 GOTO 220
500 PRINT:PRINT"   ";
505 FOR I=12 TO 7 STEP -1:GOSUB 580
510 NEXT I
515 PRINT:I=13:GOSUB 580
520 PRINT "                       ";:PRINT B(6):PRINT "   ";
525 FOR I=0 TO 5:GOSUB 580
530 NEXT I
535 PRINT:PRINT:RETURN
580 IF B(I)<10 THEN PRINT " ";
585 PRINT B(I);:RETURN
600 P=B(M):B(M)=0
605 FOR P=P TO 1 STEP -1:M=M+1:IF M>13 THEN M=M-14
610 B(M)=B(M)+1:NEXT P
615 IF B(M)=1 THEN IF M<>6 THEN IF M<>13 THEN IF B(12-M)<>0 THEN 625
620 RETURN
625 B(H)=B(H)+B(12-M)+1:B(M)=0:B(12-M)=0:RETURN
800 D=-99:H=13
805 FOR I=0 TO 13:G(I)=B(I):NEXT I
810 FOR J=7 TO 12:IF B(J)=0 THEN 885
815 G=0:M=J:GOSUB 600
820 FOR I=0 TO 5:IF B(I)=0 THEN 845
825 L=B(I)+I:R=0
830 IF L>13 THEN L=L-14:R=1:GOTO 830
835 IF B(L)=0 THEN IF L<>6 THEN IF L<>13 THEN R=B(12-L)+R
840 IF R>Q THEN Q=R
845 NEXT I
850 Q=B(13)-B(6)-Q:IF C>8 THEN 875
855 K=J:IF K>6 THEN K=K-7
860 FOR I=0 TO N-1:IF F(N)*6+K=INT(F(I)/6^(7-C)+.1) THEN Q=Q-2
870 NEXT I
875 FOR I=0 TO 13:B(I)=G(I):NEXT I
880 IF Q>=D THEN A=J:D=Q
885 NEXT J
890 M=A:PRINT CHR$(42+M);:GOTO 200
900 FOR I=0 TO N-1:PRINT B(I):NEXT I
999 END
`;
    </script>

    <script type='text/javascript'>
      window.isAwaitingInput = false;
      var resolveInputPromise;

      function createInputPromise() {
        window.awaitInputPromise = new Promise(resolve => {
            resolveInputPromise = resolve;
        });
      }

      createInputPromise();

      function scrollToBottom() {
        const screenElement = document.querySelector('.screen');
        if (screenElement) {
          setTimeout(() => {
            screenElement.scrollTop = screenElement.scrollHeight;
          }, 0);
        }
      }

      var Module = {
        preRun: [],
        postRun: [],
        print: (function() {
          var outputElement = document.getElementById('output');
          if (outputElement) outputElement.innerHTML = ''; // clear browser cache
          return function(text) {
            if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
            console.log(text);
            if (outputElement) {
              outputElement.innerHTML += text + "\n";
              scrollToBottom();
            }
          };
        })(),
        printErr: function(text) {
          if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
          console.error(text);
        },
        setStatus: function(text) {
          // Do nothing
        },
        totalDependencies: 0,
        monitorRunDependencies: function(left) {
          this.totalDependencies = Math.max(this.totalDependencies, left);
          Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies - left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
        },
        onRuntimeInitialized: async function() {
            const outputElement = document.getElementById('output');
            const inputElement = document.getElementById('input');

            outputElement.innerHTML = '';

            const processLine = Module.cwrap('process_line', 'string', ['string'], { async: true });
            const get_input_buffer = Module.cwrap('get_input_buffer', 'number', []);
            const input_buffer_ptr = get_input_buffer();

            const initialOutput = await processLine('');
            outputElement.innerHTML += initialOutput;
            scrollToBottom();

            inputElement.addEventListener('keydown', async (event) => {
                if (event.key === 'Enter') {
                    const command = inputElement.value;
                    inputElement.value = '';

                    const commandWithPrompt = `>${command}\n`;
                    const existingContent = outputElement.innerHTML;

                    if (existingContent.endsWith('\n')) {
                        outputElement.innerHTML = existingContent + commandWithPrompt;
                    } else {
                        outputElement.innerHTML = existingContent + '\n' + commandWithPrompt;
                    }
                    scrollToBottom();

                    if (window.isAwaitingInput) {
                        Module.stringToUTF8(command, input_buffer_ptr, 256);
                        resolveInputPromise();
                        createInputPromise();
                    } else {
                        const result = await processLine(command);
                        if (result) {
                            outputElement.innerHTML += result;
                        }
                    }
                }
            });

            const awariLines = awariGame.trim().split('\n');
            for (const line of awariLines) {
                if (line.trim()) {
                    outputElement.innerHTML += `> ${line}\n`;
                    const result = await processLine(line);
                    if (result) {
                        outputElement.innerHTML += result;
                    }
                }
            }
            const runResult = await processLine('RUN');
            if (runResult) {
                outputElement.innerHTML += runResult;
            }
            scrollToBottom();
        }
      };
      Module.setStatus('Downloading...');
    </script>
    {{{ SCRIPT }}}
  </body>
</html>
