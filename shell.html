<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>AltairEgo BASIC</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'VT323', monospace;
        background-color: #d2b48c; /* Tan color, like old plastic */
        color: #33ff33; /* Bright green text */
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        box-sizing: border-box;
      }
      .terminal {
        background-color: #2c2c2c; /* Dark gray */
        border: 20px solid #8c7b6c; /* Darker tan */
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.5);
        padding: 20px;
        width: 80%;
        max-width: 800px;
        height: 80vh;
        display: flex;
        flex-direction: column;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        color: #f0f0f0;
      }
      .logo {
        width: 50px;
        height: 50px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cpath d='M 15,12.5 L 80,12.5 L 85,17.5 L 85,87.5 L 15,87.5 L 15,12.5 z' style='fill:%23d3bc5f'/%3E%3Crect width='40' height='25' x='30' y='12.5' style='fill:url(%23linearGradient3158)'/%3E%3Crect width='10' height='20' x='55' y='15' style='fill:%23d3bc5f'/%3E%3Crect width='55' height='40' x='22.5' y='47.5' style='fill:%23ececec'/%3E%3Crect width='4' height='3' x='16.5' y='82' style='fill:%23666666'/%3E%3Crect width='4' height='3' x='79.5' y='82' style='fill:%23666666'/%3E%3Cpath d='M 25.25,54.749987 L 74.75,54.749987' style='stroke:%23000000;stroke-width:0.5'/%3E%3Cpath d='M 25.25,59.749987 L 74.75,59.749987' style='stroke:%23000000;stroke-width:0.5'/%3E%3Cpath d='M 25.25,64.749987 L 74.75,64.749987' style='stroke:%23000000;stroke-width:0.5'/%3E%3Cpath d='M 25.25,69.749987 L 74.75,69.749987' style='stroke:%23000000;stroke-width:0.5'/%3E%3Cpath d='M 25.25,74.749987 L 74.75,74.749987' style='stroke:%23000000;stroke-width:0.5'/%3E%3Cpath d='M 25.25,79.749987 L 74.75,79.749987' style='stroke:%23000000;stroke-width:0.5'/%3E%3C/svg%3E");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }
      h1 {
        margin: 0;
        font-size: 2em;
        text-shadow: 0 0 5px #33ff33;
      }
      .github-link {
        color: #f0f0f0;
        text-decoration: none;
        font-size: 24px;
      }
      .github-link:hover {
        color: #33ff33;
      }
      .screen {
        background-color: #000;
        border: 2px solid #555;
        border-radius: 5px;
        flex: 1;
        overflow-y: scroll;
        padding: 10px;
        box-sizing: border-box;
        position: relative;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
      }
      .screen::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
        z-index: 2;
        background-size: 100% 4px, 3px 100%;
        pointer-events: none;
      }
      #output {
        width: 100%;
        height: 100%;
        color: #33ff33;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      #input-container {
        display: flex;
        margin-top: 10px;
      }
      #input-prompt {
        color: #33ff33;
        margin-right: 5px;
      }
      #input {
        flex: 1;
        background-color: transparent;
        border: none;
        color: #33ff33;
        font-family: 'VT323', monospace;
        font-size: 1em;
        outline: none;
      }
    </style>
  </head>
  <body>
    <div class="terminal">
      <div class="header">
        <div class="logo"></div>
        <h1>AltairEgo BASIC</h1>
        <a href="https://github.com/jlowder/AltairEgo" class="github-link" target="_blank" title="View on GitHub">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
        </a>
      </div>
      <div class="screen">
        <pre id="output">Loading...</pre>
      </div>
      <div id="input-container">
        <span id="input-prompt">&gt;</span>
        <input type="text" id="input" placeholder="Enter a BASIC command" autofocus>
      </div>
    </div>

    <script>
const awariGame = `
5 PRINT TAB(34);"AWARI"
7 PRINT TAB(15);"CREATIVE COMPUTING  MORRISTOWN, NEW JERSEY"
10 DATA 0
15 DIM B(13),G(13),F(50):READ N
20 PRINT:PRINT:E=0
25 FOR I=0 TO 12:B(I)=3:NEXT I
30 C=0:F(N)=0:B(13)=0:B(6)=0
35 GOSUB 500
40 PRINT "YOUR MOVE";:GOSUB 110
45 IF E=0 THEN 80
50 IF M=H THEN GOSUB 100
55 IF E=0 THEN 80
60 PRINT "MY MOVE IS ";:GOSUB 800
65 IF E=0 THEN 80
70 IF M=H THEN PRINT ",";:GOSUB 800
75 IF E>0 THEN 35
80 PRINT:PRINT"GAME OVER"
85 D=B(6)-B(13):IF D<0 THEN PRINT "I WIN BY";-D;"POINTS":GOTO 20
90 N=N+1:IF D=0 THEN PRINT "DRAWN GAME":GOTO 20
95 PRINT "YOU WIN BY";D;"POINTS":GOTO 20
100 PRINT "AGAIN";
110 INPUT M:IF M<7 THEN IF M>0 THEN M=M-1:GOTO 130
120 PRINT "ILLEGAL MOVE":GOTO 100
130 IF B(M)=0 THEN 120
140 H=6:GOSUB 200
150 GOTO 500
200 K=M:GOSUB 600
205 E=0:IF K>6 THEN K=K-7
210 C=C+1:IF C<9 THEN F(N)=F(N)*6+K
215 FOR I=0 TO 5:IF B(I)<>0 THEN 230
220 NEXT I
225 RETURN
230 FOR I=7 TO 12:IF B(I)<>0 THEN E=1:RETURN
235 GOTO 220
500 PRINT:PRINT"   ";
505 FOR I=12 TO 7 STEP -1:GOSUB 580
510 NEXT I
515 PRINT:I=13:GOSUB 580
520 PRINT "                       ";:PRINT B(6):PRINT "   ";
525 FOR I=0 TO 5:GOSUB 580
530 NEXT I
535 PRINT:PRINT:RETURN
580 IF B(I)<10 THEN PRINT " ";
585 PRINT B(I);:RETURN
600 P=B(M):B(M)=0
605 FOR P=P TO 1 STEP -1:M=M+1:IF M>13 THEN M=M-14
610 B(M)=B(M)+1:NEXT P
615 IF B(M)=1 THEN IF M<>6 THEN IF M<>13 THEN IF B(12-M)<>0 THEN 625
620 RETURN
625 B(H)=B(H)+B(12-M)+1:B(M)=0:B(12-M)=0:RETURN
800 D=-99:H=13
805 FOR I=0 TO 13:G(I)=B(I):NEXT I
810 FOR J=7 TO 12:IF B(J)=0 THEN 885
815 G=0:M=J:GOSUB 600
820 FOR I=0 TO 5:IF B(I)=0 THEN 845
825 L=B(I)+I:R=0
830 IF L>13 THEN L=L-14:R=1:GOTO 830
835 IF B(L)=0 THEN IF L<>6 THEN IF L<>13 THEN R=B(12-L)+R
840 IF R>Q THEN Q=R
845 NEXT I
850 Q=B(13)-B(6)-Q:IF C>8 THEN 875
855 K=J:IF K>6 THEN K=K-7
860 FOR I=0 TO N-1:IF F(N)*6+K=INT(F(I)/6^(7-C)+.1) THEN Q=Q-2
870 NEXT I
875 FOR I=0 TO 13:B(I)=G(I):NEXT I
880 IF Q>=D THEN A=J:D=Q
885 NEXT J
890 M=A:PRINT CHR$(42+M);:GOTO 200
900 FOR I=0 TO N-1:PRINT B(I):NEXT I
999 END
`;
    </script>

    <script type='text/javascript'>
      window.isAwaitingInput = false;
      var resolveInputPromise;

      function createInputPromise() {
        window.awaitInputPromise = new Promise(resolve => {
            resolveInputPromise = resolve;
        });
      }

      createInputPromise();

      function scrollToBottom() {
        const screenElement = document.querySelector('.screen');
        if (screenElement) {
          setTimeout(() => {
            screenElement.scrollTop = screenElement.scrollHeight;
          }, 0);
        }
      }

      var Module = {
        preRun: [],
        postRun: [],
        print: (function() {
          var outputElement = document.getElementById('output');
          if (outputElement) outputElement.innerHTML = ''; // clear browser cache
          return function(text) {
            if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
            console.log(text);
            if (outputElement) {
              outputElement.innerHTML += text + "\n";
              scrollToBottom();
            }
          };
        })(),
        printErr: function(text) {
          if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
          console.error(text);
        },
        setStatus: function(text) {
          // Do nothing
        },
        totalDependencies: 0,
        monitorRunDependencies: function(left) {
          this.totalDependencies = Math.max(this.totalDependencies, left);
          Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies - left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
        },
        onRuntimeInitialized: async function() {
            const outputElement = document.getElementById('output');
            const inputElement = document.getElementById('input');

            outputElement.innerHTML = '';

            const processLine = Module.cwrap('process_line', 'string', ['string'], { async: true });

            const initialOutput = await processLine('');
            outputElement.innerHTML += initialOutput;
            scrollToBottom();

            inputElement.addEventListener('keydown', async (event) => {
                if (event.key === 'Enter') {
                    const command = inputElement.value;
                    inputElement.value = '';

                    const commandWithPrompt = `>${command}\n`;
                    const existingContent = outputElement.innerHTML;

                    if (existingContent.endsWith('\n')) {
                        outputElement.innerHTML = existingContent + commandWithPrompt;
                    } else {
                        outputElement.innerHTML = existingContent + '\n' + commandWithPrompt;
                    }
                    scrollToBottom();

                    if (window.isAwaitingInput) {
                        const get_input_buffer = Module.cwrap('get_input_buffer', 'number', []);
                        const input_buffer_ptr = get_input_buffer();
                        Module.stringToUTF8(command, input_buffer_ptr, 256);
                        resolveInputPromise();
                        createInputPromise();
                    } else {
                        const result = await processLine(command);
                        if (result) {
                            outputElement.innerHTML += result;
                        }
                    }
                }
            });

            const awariLines = awariGame.trim().split('\n');
            for (const line of awariLines) {
                if (line.trim()) {
                    outputElement.innerHTML += `> ${line}\n`;
                    const result = await processLine(line);
                    if (result) {
                        outputElement.innerHTML += result;
                    }
                }
            }
            const runResult = await processLine('RUN');
            if (runResult) {
                outputElement.innerHTML += runResult;
            }
            scrollToBottom();
        }
      };
      Module.setStatus('Downloading...');
    </script>
    {{{ SCRIPT }}}
  </body>
</html>
